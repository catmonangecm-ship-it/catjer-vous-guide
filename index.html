<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur de Repas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Segoe UI', sans-serif;
            background: linear-gradient(45deg, #FF6B9D, #C06C84, #6C5B7B, #355C7D);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: bounceIn 0.6s ease;
            border: 5px solid #FF6B9D;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .header h1 {
            background: linear-gradient(45deg, #FF6B9D, #FFA07A, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #666;
            font-size: 1em;
            margin-bottom: 5px;
        }

        .credit {
            color: #999;
            font-size: 0.9em;
            font-style: italic;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-bar {
            width: 100%;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 4px solid #FF6B9D;
            border-radius: 50px;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.4);
            transform: scale(1.02);
        }

        .search-btn {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 107, 157, 0.5);
        }

        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #FF6B9D;
            font-weight: bold;
            font-size: 1.2em;
        }

        .api-source {
            display: inline-block;
            background: linear-gradient(135deg, #9370DB, #BA55D3);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            margin-left: 8px;
        }

        .nav-btn {
            background: white;
            border: 4px solid #FF6B9D;
            padding: 18px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
            color: #FF6B9D;
        }

        .nav-btn:hover {
            transform: translateY(-5px) rotate(2deg);
            box-shadow: 0 12px 30px rgba(255, 107, 157, 0.5);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            border-color: white;
            transform: scale(1.1);
        }

        .content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }

        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            animation: slideUp 0.5s ease;
            border: 5px solid #FFD700;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card h2 {
            background: linear-gradient(45deg, #FF6B9D, #FFA07A);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .filter-btn {
            background: linear-gradient(135deg, #FFE5EC, #FFF0F5);
            border: 3px solid #FF6B9D;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            color: #FF6B9D;
        }

        .filter-btn:hover {
            transform: scale(1.1) rotate(-2deg);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            border-color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.5);
        }

        .recette-list {
            max-height: 600px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .recette-item {
            border: 4px solid #FFD700;
            border-radius: 20px;
            padding: 20px;
            cursor: grab;
            transition: all 0.3s;
            position: relative;
            background: linear-gradient(135deg, #FFF9E6, #FFFEF0);
        }

        .recette-item:active {
            cursor: grabbing;
        }

        .recette-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .recette-item:hover {
            border-color: #FF6B9D;
            box-shadow: 0 10px 30px rgba(255, 107, 157, 0.4);
            transform: translateX(10px) rotate(1deg);
        }

        .recette-item.perso {
            border-color: #00CED1;
            background: linear-gradient(135deg, #E0FFFF, #F0FFFF);
        }

        .recette-item h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .rating {
            display: flex;
            gap: 4px;
            margin-top: 8px;
            align-items: center;
        }

        .star {
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.2s;
            user-select: none;
        }

        .star:hover {
            transform: scale(1.2);
        }

        .star.filled {
            color: #FFD700;
        }

        .star.empty {
            color: #ddd;
        }

        .rating-display {
            font-size: 0.85em;
            color: #666;
            margin-left: 8px;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-right: 10px;
            box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);
        }

        .badge.perso {
            background: linear-gradient(135deg, #00CED1, #20B2AA);
        }

        .delete-mini-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #FF1744, #FF5252);
            color: white;
            border: 3px solid white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(255, 23, 68, 0.4);
            transition: all 0.3s;
        }

        .delete-mini-btn:hover {
            transform: rotate(90deg) scale(1.2);
        }

        .planning-grid {
            display: grid;
            gap: 15px;
        }

        .jour-item {
            border: 3px solid #FFD700;
            border-radius: 15px;
            padding: 12px;
            background: linear-gradient(135deg, #FFF9E6, #FFFEF0);
        }

        .jour-header {
            margin-bottom: 10px;
        }

        .jour-header h3 {
            color: #FF6B9D;
            font-size: 1.1em;
        }

        .repas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .repas-slot {
            background: white;
            padding: 10px;
            border-radius: 12px;
            border: 3px dashed #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            min-height: 70px;
            transition: all 0.3s;
        }

        .repas-slot.drag-over {
            border-color: #FF6B9D;
            background: linear-gradient(135deg, #FFE5EC, #FFF0F5);
            transform: scale(1.05);
        }

        .repas-slot.midi {
            border-left: 6px solid #FFD700;
        }

        .repas-slot.soir {
            border-left: 6px solid #9370DB;
        }

        .repas-label {
            font-weight: bold;
            font-size: 0.8em;
            color: #666;
            margin-bottom: 5px;
            text-align: center;
        }

        .repas-content {
            min-height: 35px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .repas-content.empty {
            color: #999;
            font-style: italic;
            text-align: center;
        }

        .plat-info {
            font-weight: bold;
            color: #FF6B9D;
            margin-bottom: 5px;
            font-size: 0.85em;
            text-align: center;
        }

        .delete-btn {
            background: linear-gradient(135deg, #FF1744, #FF5252);
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.7em;
            margin-top: 5px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(255, 23, 68, 0.3);
            transition: all 0.3s;
            width: 100%;
        }

        .delete-btn:hover {
            transform: scale(1.1);
        }

        .liste-courses {
            display: grid;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #FFE5EC, #FFF0F5);
            border-radius: 15px;
            font-weight: 500;
            border: 3px solid #FF6B9D;
            transition: all 0.3s;
        }

        .ingredient-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.3);
        }

        .ingredient-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .copy-ingredient-btn {
            background: linear-gradient(135deg, #00CED1, #20B2AA);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 206, 209, 0.3);
        }

        .copy-ingredient-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 206, 209, 0.5);
        }

        .search-ingredient-btn {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);
        }

        .search-ingredient-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(255, 107, 157, 0.5);
        }

        .ingredient-item.copied {
            background: linear-gradient(135deg, #C8E6C9, #E8F5E9);
            border-color: #4CAF50;
        }

        .check-mark {
            color: #4CAF50;
            font-size: 1.5em;
            font-weight: bold;
        }

        .supermarche-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .supermarche-btn {
            padding: 25px;
            border: 4px solid white;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .supermarche-btn:hover {
            transform: translateY(-8px) rotate(-2deg);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
        }

        .carrefour { background: linear-gradient(135deg, #0055a5, #003d7a); }
        .auchan { background: linear-gradient(135deg, #ed1c24, #b71c1c); }
        .leclerc { background: linear-gradient(135deg, #00a651, #007c3d); }
        .intermarche { background: linear-gradient(135deg, #ff6b35, #f74902); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-results {
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            border-radius: 30px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 6px solid #FF6B9D;
        }

        @keyframes popIn {
            from { transform: scale(0.5) rotate(-5deg); opacity: 0; }
            to { transform: scale(1) rotate(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            padding: 35px;
            border-radius: 24px 24px 0 0;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            border: none;
            color: #FF6B9D;
            font-size: 28px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .modal-close:hover {
            transform: rotate(90deg) scale(1.2);
        }

        .modal-body {
            padding: 35px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #FF6B9D;
            font-size: 1.1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 3px solid #FFD700;
            border-radius: 15px;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #FF6B9D;
            box-shadow: 0 0 15px rgba(255, 107, 157, 0.3);
        }

        .ingredient-inputs {
            display: grid;
            gap: 12px;
        }

        .ingredient-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 12px;
            align-items: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            border: 4px solid white;
            padding: 18px 35px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            width: 100%;
            margin-top: 25px;
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(255, 107, 157, 0.6);
        }

        .btn-add {
            background: linear-gradient(135deg, #00CED1, #20B2AA);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-add:hover {
            transform: scale(1.2) rotate(90deg);
        }

        .btn-remove {
            background: linear-gradient(135deg, #FF1744, #FF5252);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-remove:hover {
            transform: scale(1.2);
        }

        .repas-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .repas-btn {
            padding: 15px;
            border: 3px solid #FFD700;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .repas-btn:hover {
            border-color: #FF6B9D;
            transform: scale(1.05);
        }

        .repas-btn.selected {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            border-color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
        }

        .etapes-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .etape-row {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 12px;
            align-items: start;
        }

        .etape-number {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        ::-webkit-scrollbar {
            width: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #FFE5EC;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #FF6B9D, #FFA07A);
            border-radius: 10px;
        }

        .courses-badge {
            background: linear-gradient(135deg, #FF1744, #FF5252);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            margin-left: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .copy-btn {
            background: linear-gradient(135deg, #9370DB, #6A5ACD);
            color: white;
            border: 4px solid white;
            padding: 18px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
            width: 100%;
            margin-bottom: 25px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(147, 112, 219, 0.4);
            transition: all 0.3s;
        }

        .copy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(147, 112, 219, 0.6);
        }

        .instruction-box {
            background: linear-gradient(135deg, #E3F2FD, #BBDEFB);
            border: 3px solid #2196F3;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            color: #1565C0;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .instruction-box strong {
            color: #0D47A1;
            font-size: 1.1em;
        }

        .copy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 30px rgba(147, 112, 219, 0.6);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 100px;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(400px); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üç≥ Planificateur de Repas</h1>
            <p>Organisez vos repas de la semaine facilement !</p>
            <p class="credit">by Dory Bis</p>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="changerVue('recettes')">üìö Recettes</button>
            <button class="nav-btn" onclick="changerVue('planning')">üìÖ Planning</button>
            <button class="nav-btn" onclick="changerVue('courses')">üõí Courses<span id="courses-badge"></span></button>
            <button class="nav-btn" onclick="ouvrirModalNouvelleRecette()">‚ûï Nouvelle Recette</button>
            <button class="nav-btn" onclick="ouvrirModalIA()">ü§ñ Inventer avec IA</button>
        </div>

        <!-- VUE RECETTES -->
        <div id="view-recettes" class="view active">
            <div class="content">
                <div class="card">
                    <h2>üìñ Recettes</h2>
                    
                    <p style="color: #666; font-size: 0.85em; margin-bottom: 15px; padding: 15px; background: linear-gradient(135deg, #E3F2FD, #BBDEFB); border-radius: 15px; border: 2px solid #2196F3;">
                        üí° <strong>Astuce :</strong> Pour ajouter plus de recettes, utilisez le bouton <strong>"‚ûï Nouvelle Recette"</strong> ci-dessus pour cr√©er vos propres recettes personnalis√©es !
                    </p>
                    
                    <div class="filters" id="filters"></div>
                    <div id="loading-recipes" class="loading" style="display:none;">
                        üîÑ Chargement...
                    </div>
                    <div class="recette-list" id="recette-list"></div>
                </div>

                <div class="card">
                    <h2>üìÖ Planning Semaine</h2>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.85em;">
                        üí° <strong>Glissez-d√©posez</strong> une recette ou <strong>cliquez</strong> pour les d√©tails
                    </p>
                    <div class="planning-grid" id="planning-rapide"></div>
                </div>
            </div>
        </div>

        <!-- VUE PLANNING -->
        <div id="view-planning" class="view">
            <div class="card">
                <h2>üìÖ Planning Hebdo</h2>
                <div class="planning-grid" id="planning-complet"></div>
            </div>
        </div>

        <!-- VUE COURSES -->
        <div id="view-courses" class="view">
            <div class="card">
                <h2>üõí Ma Liste de Courses</h2>
                <div id="courses-content"></div>
            </div>
            
            <div class="card" id="supermarches-section" style="display:none; margin-top: 25px;">
                <h2>üè™ Faire vos Courses en Ligne</h2>
                
                <div class="instruction-box">
                    <strong>üîç Deux m√©thodes selon votre supermarch√© :</strong><br>
                    <strong style="color: #0D47A1;">üõí Carrefour & Auchan :</strong> Cliquez sur "Rechercher" ‚Üí r√©sultats directs<br>
                    <strong style="color: #0D47A1;">üõçÔ∏è Leclerc & Intermarch√© :</strong> Cliquez sur "Copier" ‚Üí Collez sur le site
                </div>

                <div class="supermarche-grid" style="margin-bottom: 30px;">
                    <button class="supermarche-btn carrefour" onclick="choisirSupermarche('Carrefour', 'https://www.carrefour.fr/s?q=', true)">
                        üõí Carrefour
                    </button>
                    <button class="supermarche-btn auchan" onclick="choisirSupermarche('Auchan', 'https://www.auchan.fr/recherche?text=', true)">
                        üè™ Auchan
                    </button>
                    <button class="supermarche-btn leclerc" onclick="choisirSupermarche('Leclerc Drive', 'https://www.leclercdrive.fr', false)">
                        üõçÔ∏è Leclerc Drive
                    </button>
                    <button class="supermarche-btn intermarche" onclick="choisirSupermarche('Intermarch√©', 'https://www.intermarche.com', false)">
                        üè¨ Intermarch√©
                    </button>
                </div>

                <div id="supermarche-choisi" style="display:none;">
                    <div style="background: linear-gradient(135deg, #4CAF50, #66BB6A); color: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 20px; font-weight: bold; font-size: 1.1em;">
                        üìç Supermarch√© s√©lectionn√© : <span id="nom-supermarche"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL D√âTAIL RECETTE -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="fermerModal()">√ó</button>
                <h2 id="modal-titre" style="margin-bottom: 10px;"></h2>
                <div id="modal-info"></div>
            </div>
            <div class="modal-body">
                <h3 style="color: #FF6B9D; margin-bottom: 20px; font-size: 1.5em;">üõí Ingr√©dients</h3>
                <div id="modal-ingredients" style="display: grid; gap: 10px; margin-bottom: 30px;"></div>
                
                <h3 style="color: #FF6B9D; margin: 30px 0 20px; font-size: 1.5em;">üë®‚Äçüç≥ Pr√©paration</h3>
                <div id="modal-preparation"></div>
                
                <h3 style="color: #FF6B9D; margin: 30px 0 20px; font-size: 1.5em;">üìÖ Ajouter au planning</h3>
                <div class="repas-selector" id="modal-repas"></div>
            </div>
        </div>
    </div>

    <!-- MODAL NOUVELLE RECETTE -->
    <div id="modal-nouvelle-recette" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="fermerModalNouvelleRecette()">√ó</button>
                <h2>‚ûï Cr√©er une Nouvelle Recette</h2>
            </div>
            <div class="modal-body">
                <form id="form-nouvelle-recette" onsubmit="sauvegarderNouvelleRecette(event)">
                    <div class="form-group">
                        <label>Nom de la recette *</label>
                        <input type="text" id="nom-recette" required placeholder="Ex: Poulet curry">
                    </div>

                    <div class="form-group">
                        <label>Cat√©gorie *</label>
                        <select id="categorie-recette" required>
                            <option value="">Choisir...</option>
                            <option value="P√¢tes">P√¢tes</option>
                            <option value="Viandes">Viandes</option>
                            <option value="Poissons">Poissons</option>
                            <option value="V√©g√©tarien">V√©g√©tarien</option>
                            <option value="Soupes">Soupes</option>
                            <option value="Salades">Salades</option>
                            <option value="Tartes">Tartes</option>
                            <option value="Desserts">Desserts</option>
                            <option value="Diab√©tique">Diab√©tique</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Temps de pr√©paration</label>
                        <input type="text" id="temps-recette" placeholder="Ex: 30min">
                    </div>

                    <div class="form-group">
                        <label>Nombre de portions</label>
                        <input type="number" id="portions-recette" value="4" min="1">
                    </div>

                    <div class="form-group">
                        <label>Ingr√©dients *</label>
                        <div class="ingredient-inputs" id="ingredients-inputs">
                            <div class="ingredient-row">
                                <input type="text" placeholder="Nom ingr√©dient" class="ing-nom" required>
                                <input type="text" placeholder="Quantit√©" class="ing-qte" required>
                                <button type="button" class="btn-add" onclick="ajouterIngredient()">+</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>√âtapes de pr√©paration *</label>
                        <div class="etapes-list" id="etapes-list">
                            <div class="etape-row">
                                <div class="etape-number">1</div>
                                <textarea rows="3" class="etape-text" required placeholder="D√©crivez l'√©tape 1..."></textarea>
                                <button type="button" class="btn-add" onclick="ajouterEtape()">+</button>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-primary">üíæ Sauvegarder la Recette</button>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL R√âSULTATS DE RECHERCHE -->
    <div id="modal-resultats" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="fermerModalResultats()">√ó</button>
                <h2 id="titre-resultats">üìö R√©sultats de recherche</h2>
            </div>
            <div class="modal-body modal-results" id="contenu-resultats">
            </div>
        </div>
    </div>

    <!-- MODAL G√âN√âRATION IA -->
    <div id="modal-ia" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="modal-close" onclick="fermerModalIA()">√ó</button>
                <h2>ü§ñ Inventer une Recette avec l'IA</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #666; line-height: 1.6;">
                    L'IA va inventer une recette <strong>unique et originale</strong> bas√©e sur vos envies !
                </p>
                
                <div class="form-group">
                    <label>üçΩÔ∏è Type de plat souhait√© *</label>
                    <select id="ia-type" style="width: 100%; padding: 15px; border: 3px solid #FFD700; border-radius: 15px; font-size: 1em;">
                        <option value="">Surprise moi !</option>
                        <option value="entr√©e">Entr√©e</option>
                        <option value="plat principal">Plat principal</option>
                        <option value="accompagnement">Accompagnement</option>
                        <option value="dessert">Dessert</option>
                        <option value="go√ªter">Go√ªter</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ü•ó Ingr√©dient principal (optionnel)</label>
                    <input type="text" id="ia-ingredient" placeholder="Ex: poulet, saumon, chocolat, l√©gumes..." style="width: 100%; padding: 15px; border: 3px solid #FFD700; border-radius: 15px; font-size: 1em;">
                </div>

                <div class="form-group">
                    <label>üåç Style de cuisine (optionnel)</label>
                    <select id="ia-style" style="width: 100%; padding: 15px; border: 3px solid #FFD700; border-radius: 15px; font-size: 1em;">
                        <option value="">Peu importe</option>
                        <option value="fran√ßaise">Fran√ßaise</option>
                        <option value="italienne">Italienne</option>
                        <option value="asiatique">Asiatique</option>
                        <option value="m√©diterran√©enne">M√©diterran√©enne</option>
                        <option value="mexicaine">Mexicaine</option>
                        <option value="v√©g√©tarienne">V√©g√©tarienne</option>
                        <option value="healthy">Healthy</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>‚è±Ô∏è Temps de pr√©paration souhait√©</label>
                    <select id="ia-temps" style="width: 100%; padding: 15px; border: 3px solid #FFD700; border-radius: 15px; font-size: 1em;">
                        <option value="">Peu importe</option>
                        <option value="moins de 20 minutes">Rapide (moins de 20 min)</option>
                        <option value="20-40 minutes">Moyen (20-40 min)</option>
                        <option value="plus de 40 minutes">Long (plus de 40 min)</option>
                    </select>
                </div>

                <button class="btn-primary" onclick="genererRecetteIA()">
                    ‚ú® Inventer ma recette !
                </button>

                <div id="ia-loading" style="display: none; text-align: center; margin-top: 20px; color: #FF6B9D; font-weight: bold;">
                    ü§ñ L'IA invente votre recette originale...<br>
                    <small style="color: #999;">Cela peut prendre 10-15 secondes</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        const recettesPredefinies = [
            // P√ÇTES (6 recettes)
            { id: 1, nom: "P√¢tes Carbonara", cat: "P√¢tes", temps: "20min", p: 4, perso: false,
                ing: [{n:"Spaghetti",q:"400g"}, {n:"Lardons",q:"200g"}, {n:"≈íufs",q:"4"}, {n:"Parmesan",q:"100g"}, {n:"Cr√®me",q:"20cl"}],
                rec: ["Cuire les p√¢tes al dente.", "Faire revenir les lardons.", "M√©langer ≈ìufs, cr√®me et parmesan.", "Ajouter aux p√¢tes hors du feu.", "Poivrer g√©n√©reusement."]
            },
            { id: 2, nom: "P√¢tes Bolognaise", cat: "P√¢tes", temps: "45min", p: 4, perso: false,
                ing: [{n:"P√¢tes",q:"400g"}, {n:"Viande hach√©e",q:"500g"}, {n:"Tomates",q:"800g"}, {n:"Oignons",q:"2"}, {n:"Ail",q:"3 gousses"}],
                rec: ["Faire revenir oignons et ail.", "Ajouter la viande et dorer.", "Ajouter tomates et herbes.", "Mijoter 30min.", "Servir sur p√¢tes."]
            },
            { id: 3, nom: "Lasagnes", cat: "P√¢tes", temps: "1h30", p: 6, perso: false,
                ing: [{n:"Plaques lasagnes",q:"12"}, {n:"Viande hach√©e",q:"600g"}, {n:"B√©chamel",q:"50cl"}, {n:"Mozzarella",q:"200g"}],
                rec: ["Pr√©parer bolognaise.", "Alterner p√¢tes, bolognaise, b√©chamel.", "Terminer par fromages.", "Four 180¬∞C 40min."]
            },
            { id: 4, nom: "P√¢tes aux Fruits de Mer", cat: "P√¢tes", temps: "30min", p: 4, perso: false,
                ing: [{n:"Linguine",q:"400g"}, {n:"Fruits de mer",q:"500g"}, {n:"Ail",q:"4 gousses"}, {n:"Vin blanc",q:"15cl"}, {n:"Persil",q:"1 bouquet"}],
                rec: ["Cuire les p√¢tes.", "Faire revenir ail dans huile d'olive.", "Ajouter fruits de mer et vin blanc.", "M√©langer avec p√¢tes et persil.", "Servir imm√©diatement."]
            },
            { id: 5, nom: "P√¢tes Pesto", cat: "P√¢tes", temps: "15min", p: 4, perso: false,
                ing: [{n:"P√¢tes courtes",q:"400g"}, {n:"Pesto",q:"150g"}, {n:"Tomates cerises",q:"250g"}, {n:"Parmesan",q:"80g"}, {n:"Pignons",q:"50g"}],
                rec: ["Cuire les p√¢tes.", "Griller les pignons.", "M√©langer p√¢tes chaudes avec pesto.", "Ajouter tomates coup√©es.", "Parsemer de parmesan et pignons."]
            },
            { id: 6, nom: "P√¢tes Cr√®me Champignons", cat: "P√¢tes", temps: "25min", p: 4, perso: false,
                ing: [{n:"Tagliatelles",q:"400g"}, {n:"Champignons",q:"500g"}, {n:"Cr√®me fra√Æche",q:"30cl"}, {n:"√âchalotes",q:"3"}, {n:"Persil",q:"1 bouquet"}],
                rec: ["Cuire les p√¢tes.", "Faire revenir √©chalotes et champignons.", "Ajouter cr√®me et laisser r√©duire.", "M√©langer avec p√¢tes.", "Parsemer de persil."]
            },
            
            // VIANDES (6 recettes)
            { id: 7, nom: "Poulet R√¥ti", cat: "Viandes", temps: "1h30", p: 4, perso: false,
                ing: [{n:"Poulet",q:"1.5kg"}, {n:"Pommes de terre",q:"800g"}, {n:"Carottes",q:"500g"}, {n:"Herbes",q:"2 c.√†.s"}],
                rec: ["Pr√©chauffer four 200¬∞C.", "Assaisonner le poulet.", "Disposer l√©gumes autour.", "Enfourner 1h30.", "Arroser r√©guli√®rement."]
            },
            { id: 8, nom: "Poulet Curry", cat: "Viandes", temps: "35min", p: 4, perso: false,
                ing: [{n:"Blancs de poulet",q:"4"}, {n:"Curry",q:"3 c.√†.s"}, {n:"Lait coco",q:"40cl"}, {n:"Oignons",q:"2"}, {n:"Riz",q:"300g"}],
                rec: ["Couper poulet en morceaux.", "Faire revenir avec oignons.", "Ajouter curry et lait coco.", "Mijoter 20min.", "Servir avec riz."]
            },
            { id: 9, nom: "B≈ìuf Bourguignon", cat: "Viandes", temps: "2h30", p: 6, perso: false,
                ing: [{n:"B≈ìuf",q:"1kg"}, {n:"Vin rouge",q:"75cl"}, {n:"Carottes",q:"4"}, {n:"Oignons",q:"3"}, {n:"Lardons",q:"200g"}],
                rec: ["Faire dorer la viande.", "Ajouter l√©gumes et lardons.", "Mouiller au vin rouge.", "Mijoter 2h √† feu doux.", "Servir avec p√¢tes."]
            },
            { id: 10, nom: "Escalope Milanaise", cat: "Viandes", temps: "25min", p: 4, perso: false,
                ing: [{n:"Escalopes veau",q:"4"}, {n:"Chapelure",q:"150g"}, {n:"≈íufs",q:"2"}, {n:"Parmesan",q:"50g"}, {n:"Citron",q:"2"}],
                rec: ["Aplatir les escalopes.", "Paner avec ≈ìuf puis chapelure-parmesan.", "Faire frire 3min par c√¥t√©.", "Servir avec citron.", "Accompagner de salade."]
            },
            { id: 11, nom: "C√¥tes Agneau Grill√©es", cat: "Viandes", temps: "20min", p: 4, perso: false,
                ing: [{n:"C√¥tes d'agneau",q:"8"}, {n:"Romarin",q:"3 branches"}, {n:"Ail",q:"4 gousses"}, {n:"Huile olive",q:"4 c.√†.s"}],
                rec: ["Mariner agneau 1h.", "Pr√©chauffer grill.", "Griller 3-4min par c√¥t√©.", "Laisser reposer 5min.", "Servir avec l√©gumes."]
            },
            { id: 12, nom: "Blanquette de Veau", cat: "Viandes", temps: "2h", p: 6, perso: false,
                ing: [{n:"Veau",q:"1kg"}, {n:"Carottes",q:"3"}, {n:"Champignons",q:"300g"}, {n:"Cr√®me",q:"20cl"}, {n:"Citron",q:"1"}],
                rec: ["Cuire veau dans bouillon 1h30.", "Ajouter carottes et champignons.", "Lier sauce avec cr√®me.", "Ajouter jus de citron.", "Servir avec riz."]
            },
            
            // POISSONS (4 recettes)
            { id: 13, nom: "Saumon Grill√©", cat: "Poissons", temps: "20min", p: 4, perso: false,
                ing: [{n:"Filets saumon",q:"4"}, {n:"Citron",q:"2"}, {n:"Aneth",q:"1 bouquet"}, {n:"Beurre",q:"50g"}],
                rec: ["Cuire saumon 4min c√¥t√© peau.", "Retourner 3min.", "Ajouter beurre citronn√©.", "Parsemer d'aneth.", "Servir avec l√©gumes."]
            },
            { id: 14, nom: "Cabillaud au Four", cat: "Poissons", temps: "30min", p: 4, perso: false,
                ing: [{n:"Filets cabillaud",q:"4"}, {n:"Tomates",q:"4"}, {n:"Olives",q:"100g"}, {n:"Basilic",q:"1 bouquet"}, {n:"Ail",q:"3 gousses"}],
                rec: ["Disposer poisson dans plat.", "Ajouter tomates, olives, ail.", "Arroser d'huile d'olive.", "Four 180¬∞C 25min.", "Parsemer de basilic."]
            },
            { id: 15, nom: "Sole Meuni√®re", cat: "Poissons", temps: "15min", p: 4, perso: false,
                ing: [{n:"Soles",q:"4"}, {n:"Farine",q:"100g"}, {n:"Beurre",q:"100g"}, {n:"Citron",q:"2"}, {n:"Persil",q:"1 bouquet"}],
                rec: ["Fariner les soles.", "Cuire au beurre 3min par c√¥t√©.", "Faire mousser le beurre.", "Ajouter jus de citron.", "Parsemer de persil."]
            },
            { id: 16, nom: "Dorade Sauce Vierge", cat: "Poissons", temps: "25min", p: 4, perso: false,
                ing: [{n:"Filets dorade",q:"4"}, {n:"Tomates",q:"4"}, {n:"Basilic",q:"1 bouquet"}, {n:"Huile olive",q:"10cl"}, {n:"Citron",q:"1"}],
                rec: ["Griller les filets.", "Concasser tomates avec basilic.", "M√©langer avec huile et citron.", "Verser sauce sur poisson.", "Servir ti√®de."]
            },
            
            // V√âG√âTARIEN (5 recettes)
            { id: 17, nom: "Curry de L√©gumes", cat: "V√©g√©tarien", temps: "40min", p: 4, perso: false,
                ing: [{n:"Lait coco",q:"40cl"}, {n:"Curry",q:"3 c.√†.s"}, {n:"Patates douces",q:"400g"}, {n:"Pois chiches",q:"1 bo√Æte"}],
                rec: ["Revenir curry dans huile.", "Ajouter patates douces.", "Ajouter lait coco et mijoter 20min.", "Ajouter pois chiches.", "Servir avec riz."]
            },
            { id: 18, nom: "Ratatouille", cat: "V√©g√©tarien", temps: "1h", p: 6, perso: false,
                ing: [{n:"Aubergines",q:"2"}, {n:"Courgettes",q:"3"}, {n:"Poivrons",q:"2"}, {n:"Tomates",q:"6"}],
                rec: ["Couper l√©gumes en d√©s.", "Revenir un par un.", "Ajouter tomates et herbes.", "Mijoter 45min.", "Servir chaud ou froid."]
            },
            { id: 19, nom: "Gratin Dauphinois", cat: "V√©g√©tarien", temps: "1h15", p: 6, perso: false,
                ing: [{n:"Pommes de terre",q:"1.5kg"}, {n:"Cr√®me",q:"50cl"}, {n:"Lait",q:"25cl"}, {n:"Ail",q:"2 gousses"}, {n:"Gruy√®re",q:"100g"}],
                rec: ["Trancher pommes de terre.", "Frotter plat avec ail.", "Alterner couches cr√®me.", "Parsemer de fromage.", "Four 180¬∞C 1h."]
            },
            { id: 20, nom: "Buddha Bowl", cat: "V√©g√©tarien", temps: "30min", p: 4, perso: false,
                ing: [{n:"Quinoa",q:"300g"}, {n:"Pois chiches",q:"400g"}, {n:"Avocat",q:"2"}, {n:"Chou rouge",q:"200g"}, {n:"Graines",q:"50g"}],
                rec: ["Cuire le quinoa.", "R√¥tir pois chiches.", "√âmincer chou rouge.", "Disposer en cercle.", "Ajouter sauce tahini."]
            },
            { id: 21, nom: "Couscous V√©g√©tarien", cat: "V√©g√©tarien", temps: "50min", p: 6, perso: false,
                ing: [{n:"Semoule",q:"500g"}, {n:"Courgettes",q:"3"}, {n:"Carottes",q:"4"}, {n:"Pois chiches",q:"400g"}, {n:"√âpices",q:"3 c.√†.s"}],
                rec: ["Faire revenir l√©gumes avec √©pices.", "Ajouter pois chiches et bouillon.", "Mijoter 30min.", "Pr√©parer semoule.", "Servir ensemble."]
            },
            
            // SOUPES (4 recettes)
            { id: 22, nom: "Soupe √† l'Oignon", cat: "Soupes", temps: "1h", p: 4, perso: false,
                ing: [{n:"Oignons",q:"1kg"}, {n:"Bouillon",q:"1.5L"}, {n:"Pain",q:"4 tranches"}, {n:"Gruy√®re",q:"150g"}],
                rec: ["Caram√©liser oignons 30min.", "Ajouter bouillon.", "Mijoter 20min.", "Gratiner avec pain et fromage.", "Servir tr√®s chaud."]
            },
            { id: 23, nom: "Velout√© de Potiron", cat: "Soupes", temps: "40min", p: 6, perso: false,
                ing: [{n:"Potiron",q:"1kg"}, {n:"Pommes de terre",q:"300g"}, {n:"Bouillon",q:"1L"}, {n:"Cr√®me",q:"15cl"}, {n:"Muscade",q:"1 pinc√©e"}],
                rec: ["Couper l√©gumes.", "Cuire dans bouillon 30min.", "Mixer finement.", "Ajouter cr√®me et muscade.", "Servir avec cro√ªtons."]
            },
            { id: 24, nom: "Minestrone", cat: "Soupes", temps: "45min", p: 6, perso: false,
                ing: [{n:"Haricots blancs",q:"400g"}, {n:"Tomates",q:"400g"}, {n:"L√©gumes vari√©s",q:"500g"}, {n:"P√¢tes courtes",q:"100g"}, {n:"Parmesan",q:"80g"}],
                rec: ["Faire revenir l√©gumes.", "Ajouter tomates et haricots.", "Mijoter 30min.", "Ajouter p√¢tes 10min avant.", "Servir avec parmesan."]
            },
            { id: 25, nom: "Soupe Miso", cat: "Soupes", temps: "15min", p: 4, perso: false,
                ing: [{n:"Miso",q:"4 c.√†.s"}, {n:"Tofu",q:"200g"}, {n:"Algues wakame",q:"10g"}, {n:"Champignons",q:"150g"}, {n:"Oignons verts",q:"4"}],
                rec: ["Porter eau √† fr√©missement.", "D√©layer miso.", "Ajouter tofu en d√©s.", "Ajouter algues et champignons.", "Parsemer d'oignons."]
            },
            
            // SALADES (3 recettes)
            { id: 26, nom: "Salade C√©sar", cat: "Salades", temps: "20min", p: 4, perso: false,
                ing: [{n:"Laitue romaine",q:"2"}, {n:"Poulet",q:"2 blancs"}, {n:"Cro√ªtons",q:"100g"}, {n:"Parmesan",q:"80g"}],
                rec: ["Griller le poulet.", "M√©langer salade et sauce.", "Ajouter cro√ªtons et parmesan.", "Servir frais."]
            },
            { id: 27, nom: "Salade Ni√ßoise", cat: "Salades", temps: "25min", p: 4, perso: false,
                ing: [{n:"Thon",q:"300g"}, {n:"Tomates",q:"4"}, {n:"≈íufs",q:"4"}, {n:"Haricots verts",q:"200g"}, {n:"Olives",q:"100g"}],
                rec: ["Cuire ≈ìufs durs et haricots.", "Couper tomates.", "Disposer tous ingr√©dients.", "Ajouter thon √©miett√©.", "Assaisonner vinaigrette."]
            },
            { id: 28, nom: "Taboul√©", cat: "Salades", temps: "30min", p: 6, perso: false,
                ing: [{n:"Semoule fine",q:"300g"}, {n:"Tomates",q:"5"}, {n:"Concombre",q:"1"}, {n:"Menthe",q:"1 bouquet"}, {n:"Citron",q:"3"}],
                rec: ["Hydrater semoule.", "Concasser tomates et concombre.", "Hacher menthe.", "M√©langer tous ingr√©dients.", "Assaisonner citron."]
            },
            
            // TARTES (3 recettes)
            { id: 29, nom: "Quiche Lorraine", cat: "Tartes", temps: "55min", p: 6, perso: false,
                ing: [{n:"P√¢te bris√©e",q:"1"}, {n:"Lardons",q:"200g"}, {n:"≈íufs",q:"3"}, {n:"Cr√®me",q:"200ml"}, {n:"Gruy√®re",q:"100g"}],
                rec: ["√âtaler p√¢te.", "Disposer lardons.", "Verser m√©lange ≈ìufs-cr√®me.", "Ajouter fromage.", "Four 180¬∞C 40min."]
            },
            { id: 30, nom: "Tarte aux Poireaux", cat: "Tartes", temps: "50min", p: 6, perso: false,
                ing: [{n:"P√¢te bris√©e",q:"1"}, {n:"Poireaux",q:"4"}, {n:"Cr√®me",q:"20cl"}, {n:"≈íufs",q:"2"}, {n:"Fromage",q:"100g"}],
                rec: ["Faire fondre poireaux.", "Disposer sur p√¢te.", "Verser m√©lange ≈ìufs-cr√®me.", "Parsemer de fromage.", "Four 180¬∞C 35min."]
            },
            { id: 31, nom: "Tarte Tomates Mozza", cat: "Tartes", temps: "45min", p: 6, perso: false,
                ing: [{n:"P√¢te feuillet√©e",q:"1"}, {n:"Tomates",q:"6"}, {n:"Mozzarella",q:"250g"}, {n:"Basilic",q:"1 bouquet"}, {n:"Moutarde",q:"2 c.√†.s"}],
                rec: ["√âtaler p√¢te.", "Badigeonner de moutarde.", "Disposer tomates.", "Ajouter mozzarella.", "Four 180¬∞C 35min."]
            },
            
            // DESSERTS (5 recettes)
            { id: 32, nom: "Tiramisu", cat: "Desserts", temps: "4h", p: 8, perso: false,
                ing: [{n:"Mascarpone",q:"500g"}, {n:"≈íufs",q:"4"}, {n:"Sucre",q:"100g"}, {n:"Biscuits",q:"300g"}, {n:"Caf√©",q:"30cl"}],
                rec: ["Battre jaunes et sucre.", "Ajouter mascarpone.", "Monter blancs en neige.", "Tremper biscuits.", "Alterner couches et r√©frig√©rer 4h."]
            },
            { id: 33, nom: "Tarte aux Pommes", cat: "Desserts", temps: "50min", p: 6, perso: false,
                ing: [{n:"P√¢te sabl√©e",q:"1"}, {n:"Pommes",q:"6"}, {n:"Sucre",q:"80g"}, {n:"Cannelle",q:"1 c.√†.c"}],
                rec: ["√âtaler p√¢te.", "Disposer pommes en rosace.", "Saupoudrer sucre et cannelle.", "Four 180¬∞C 40min.", "Servir ti√®de."]
            },
            { id: 34, nom: "Fondant Chocolat", cat: "Desserts", temps: "30min", p: 6, perso: false,
                ing: [{n:"Chocolat noir",q:"200g"}, {n:"Beurre",q:"150g"}, {n:"≈íufs",q:"4"}, {n:"Sucre",q:"150g"}, {n:"Farine",q:"50g"}],
                rec: ["Fondre chocolat et beurre.", "Battre ≈ìufs et sucre.", "M√©langer le tout.", "Ajouter farine.", "Four 180¬∞C 15-20min."]
            },
            { id: 35, nom: "Cr√®me Br√ªl√©e", cat: "Desserts", temps: "4h", p: 6, perso: false,
                ing: [{n:"Cr√®me liquide",q:"50cl"}, {n:"Jaunes d'≈ìufs",q:"6"}, {n:"Sucre",q:"100g"}, {n:"Vanille",q:"1 gousse"}],
                rec: ["Infuser vanille dans cr√®me.", "M√©langer jaunes et sucre.", "Incorporer cr√®me.", "Cuire au bain-marie 160¬∞C 40min.", "R√©frig√©rer puis caram√©liser."]
            },
            { id: 36, nom: "Mousse au Chocolat", cat: "Desserts", temps: "3h", p: 6, perso: false,
                ing: [{n:"Chocolat noir",q:"200g"}, {n:"≈íufs",q:"6"}, {n:"Sucre",q:"50g"}],
                rec: ["Fondre chocolat.", "S√©parer blancs et jaunes.", "M√©langer jaunes au chocolat.", "Monter blancs en neige.", "Incorporer et r√©frig√©rer 2h."]
            },
            
            // DIAB√âTIQUE (20 recettes)
            { id: 37, nom: "Poulet Vapeur L√©gumes", cat: "Diab√©tique", temps: "30min", p: 4, perso: false,
                ing: [{n:"Blancs de poulet",q:"4"}, {n:"Brocolis",q:"400g"}, {n:"Haricots verts",q:"300g"}, {n:"Citron",q:"1"}, {n:"Herbes",q:"2 c.√†.s"}],
                rec: ["Cuire poulet vapeur 20min.", "Cuire l√©gumes vapeur 15min.", "Assaisonner citron et herbes.", "Servir avec filet d'huile.", "Sans sauces grasses."]
            },
            { id: 38, nom: "Saumon aux √âpinards", cat: "Diab√©tique", temps: "25min", p: 4, perso: false,
                ing: [{n:"Filets saumon",q:"4"}, {n:"√âpinards frais",q:"500g"}, {n:"Ail",q:"2 gousses"}, {n:"Citron",q:"1"}],
                rec: ["Cuire saumon au four 180¬∞C 15min.", "Faire tomber √©pinards avec ail.", "Servir saumon sur √©pinards.", "Arroser de citron.", "Sans mati√®res grasses."]
            },
            { id: 39, nom: "Salade de Lentilles", cat: "Diab√©tique", temps: "35min", p: 4, perso: false,
                ing: [{n:"Lentilles vertes",q:"300g"}, {n:"Tomates",q:"3"}, {n:"Concombre",q:"1"}, {n:"Oignon rouge",q:"1"}, {n:"Persil",q:"1 bouquet"}],
                rec: ["Cuire lentilles 25min.", "Couper l√©gumes en d√©s.", "M√©langer lentilles refroidies.", "Vinaigrette l√©g√®re.", "Riche en fibres IG bas."]
            },
            { id: 40, nom: "Poisson en Papillote", cat: "Diab√©tique", temps: "30min", p: 4, perso: false,
                ing: [{n:"Filets cabillaud",q:"4"}, {n:"Courgettes",q:"2"}, {n:"Tomates cerises",q:"200g"}, {n:"Basilic",q:"1 bouquet"}, {n:"Citron",q:"1"}],
                rec: ["Couper l√©gumes.", "Disposer en papillote.", "Ajouter herbes et citron.", "Four 180¬∞C 20min.", "Sans mati√®res grasses."]
            },
            { id: 41, nom: "Soupe L√©gumes Maison", cat: "Diab√©tique", temps: "40min", p: 6, perso: false,
                ing: [{n:"Carottes",q:"3"}, {n:"Poireaux",q:"2"}, {n:"C√©leri",q:"2 branches"}, {n:"Courgettes",q:"2"}, {n:"Bouillon",q:"1.5L"}],
                rec: ["Couper tous l√©gumes.", "Faire revenir sans MG.", "Ajouter bouillon 30min.", "Mixer ou laisser morceaux.", "Sans pommes de terre."]
            },
            { id: 42, nom: "Omelette Champignons", cat: "Diab√©tique", temps: "15min", p: 2, perso: false,
                ing: [{n:"≈íufs",q:"4"}, {n:"Champignons",q:"200g"}, {n:"Oignon",q:"1"}, {n:"Persil",q:"1 bouquet"}],
                rec: ["Revenir champignons et oignon.", "Battre les ≈ìufs.", "Verser sur champignons.", "Cuire √† feu doux.", "Riche prot√©ines 0 glucides."]
            },
            { id: 43, nom: "Dinde Haricots Verts", cat: "Diab√©tique", temps: "35min", p: 4, perso: false,
                ing: [{n:"Escalopes dinde",q:"4"}, {n:"Haricots verts",q:"600g"}, {n:"Tomates",q:"3"}, {n:"Oignon",q:"1"}, {n:"Herbes Provence",q:"1 c.√†.s"}],
                rec: ["Cuire haricots vapeur.", "Griller escalopes sans MG.", "Sauce tomate l√©g√®re.", "Servir ensemble.", "Repas √©quilibr√© l√©ger."]
            },
            { id: 44, nom: "Salade Quinoa L√©gumes", cat: "Diab√©tique", temps: "30min", p: 4, perso: false,
                ing: [{n:"Quinoa",q:"250g"}, {n:"Poivrons",q:"2"}, {n:"Concombre",q:"1"}, {n:"Tomates cerises",q:"200g"}, {n:"Menthe",q:"1 bouquet"}],
                rec: ["Cuire quinoa.", "Couper l√©gumes en d√©s.", "M√©langer quinoa refroidi.", "Assaisonner citron.", "IG bas riche prot√©ines."]
            },
            { id: 45, nom: "Ratatouille L√©g√®re", cat: "Diab√©tique", temps: "45min", p: 6, perso: false,
                ing: [{n:"Aubergines",q:"2"}, {n:"Courgettes",q:"3"}, {n:"Poivrons",q:"2"}, {n:"Tomates",q:"5"}, {n:"Ail",q:"3 gousses"}],
                rec: ["Couper l√©gumes.", "Cuire s√©par√©ment sans huile.", "M√©langer tous l√©gumes.", "Ajouter tomates et ail.", "Mijoter 30min 100% l√©gumes."]
            },
            { id: 46, nom: "Cabillaud L√©gumes Grill√©s", cat: "Diab√©tique", temps: "35min", p: 4, perso: false,
                ing: [{n:"Filets cabillaud",q:"4"}, {n:"Courgettes",q:"2"}, {n:"Aubergine",q:"1"}, {n:"Poivrons",q:"2"}, {n:"Thym",q:"2 branches"}],
                rec: ["Trancher l√©gumes finement.", "Griller l√©gumes au four.", "Cuire cabillaud 180¬∞C 15min.", "Servir poisson sur l√©gumes.", "Minimal en MG."]
            },
            { id: 47, nom: "Curry Poulet L√©ger", cat: "Diab√©tique", temps: "40min", p: 4, perso: false,
                ing: [{n:"Blancs poulet",q:"4"}, {n:"Curry",q:"2 c.√†.s"}, {n:"Lait coco light",q:"30cl"}, {n:"Brocolis",q:"400g"}, {n:"Oignon",q:"1"}],
                rec: ["Couper poulet.", "Faire revenir avec curry.", "Ajouter lait coco all√©g√©.", "Ajouter brocolis.", "Mijoter 25min sans riz."]
            },
            { id: 48, nom: "Courgettes Farcies", cat: "Diab√©tique", temps: "50min", p: 4, perso: false,
                ing: [{n:"Courgettes",q:"4"}, {n:"Viande hach√©e 5%",q:"300g"}, {n:"Tomates",q:"2"}, {n:"Oignon",q:"1"}, {n:"Herbes",q:"2 c.√†.s"}],
                rec: ["√âvider courgettes.", "Pr√©parer farce viande-tomates.", "Farcir courgettes.", "Four 180¬∞C 35min.", "Sans fromage ajout√©."]
            },
            { id: 49, nom: "Salade Grecque Light", cat: "Diab√©tique", temps: "15min", p: 4, perso: false,
                ing: [{n:"Tomates",q:"4"}, {n:"Concombre",q:"1"}, {n:"Poivron",q:"1"}, {n:"Olives",q:"50g"}, {n:"Feta all√©g√©e",q:"100g"}],
                rec: ["Couper l√©gumes en d√©s.", "Ajouter olives et feta.", "Assaisonner huile citron.", "Ajouter origan.", "Frais peu calorique."]
            },
            { id: 50, nom: "Poulet Grill√© √âpic√©", cat: "Diab√©tique", temps: "25min", p: 4, perso: false,
                ing: [{n:"Blancs poulet",q:"4"}, {n:"Paprika",q:"1 c.√†.s"}, {n:"Cumin",q:"1 c.√†.c"}, {n:"Citron",q:"1"}, {n:"Salade verte",q:"400g"}],
                rec: ["Mariner poulet √©pices citron.", "Griller sans MG.", "Servir avec salade.", "Vinaigre balsamique.", "Prot√©ines pures 0 glucides."]
            },
            { id: 51, nom: "Velout√© Brocolis Sans Cr√®me", cat: "Diab√©tique", temps: "30min", p: 4, perso: false,
                ing: [{n:"Brocolis",q:"800g"}, {n:"Bouillon",q:"1L"}, {n:"Oignon",q:"1"}, {n:"Ail",q:"2 gousses"}],
                rec: ["Revenir oignon et ail.", "Ajouter brocolis et bouillon.", "Cuire 20min.", "Mixer finement.", "Sans cr√®me onctueux naturel."]
            },
            { id: 52, nom: "Pav√© Saumon Asperges", cat: "Diab√©tique", temps: "25min", p: 4, perso: false,
                ing: [{n:"Pav√©s saumon",q:"4"}, {n:"Asperges vertes",q:"500g"}, {n:"Citron",q:"1"}, {n:"Aneth",q:"1 bouquet"}],
                rec: ["Cuire asperges vapeur 10min.", "Griller saumon 4min c√¥t√©.", "Arroser de citron.", "Parsemer d'aneth.", "Om√©ga-3 l√©gumes verts."]
            },
            { id: 53, nom: "Tomates Farcies L√©g√®res", cat: "Diab√©tique", temps: "1h", p: 4, perso: false,
                ing: [{n:"Grosses tomates",q:"8"}, {n:"Viande hach√©e 5%",q:"400g"}, {n:"Oignon",q:"1"}, {n:"Persil",q:"1 bouquet"}, {n:"Ail",q:"2 gousses"}],
                rec: ["√âvider tomates.", "Pr√©parer farce viande-herbes.", "Farcir tomates.", "Four 180¬∞C 45min.", "Sans riz dans farce."]
            },
            { id: 54, nom: "Poulet Tandoori Sans Yaourt", cat: "Diab√©tique", temps: "2h30", p: 4, perso: false,
                ing: [{n:"Cuisses poulet",q:"8"}, {n:"√âpices tandoori",q:"3 c.√†.s"}, {n:"Citron",q:"2"}, {n:"Ail",q:"4 gousses"}],
                rec: ["Mariner poulet 2h √©pices citron.", "Four 200¬∞C 40min.", "Servir avec l√©gumes verts.", "Sans yaourt ni MG.", "Savoureux et sain."]
            },
            { id: 55, nom: "Wok L√©gumes Tofu", cat: "Diab√©tique", temps: "20min", p: 4, perso: false,
                ing: [{n:"Tofu ferme",q:"400g"}, {n:"Brocolis",q:"300g"}, {n:"Poivrons",q:"2"}, {n:"Champignons",q:"200g"}, {n:"Sauce soja",q:"3 c.√†.s"}],
                rec: ["Couper tofu et l√©gumes.", "Sauter au wok sans huile.", "Ajouter sauce soja.", "Cuire 10min feu vif.", "Prot√©ines v√©g√©tales IG bas."]
            },
            { id: 56, nom: "Lieu Noir Petits L√©gumes", cat: "Diab√©tique", temps: "30min", p: 4, perso: false,
                ing: [{n:"Filets lieu noir",q:"4"}, {n:"Carottes",q:"3"}, {n:"Navets",q:"2"}, {n:"Haricots verts",q:"200g"}, {n:"Citron",q:"1"}],
                rec: ["Cuire l√©gumes vapeur.", "Po√™ler poisson 3min c√¥t√©.", "Servir ensemble.", "Arroser jus de citron.", "Repas complet l√©ger."]
            }
        ];

        const jours = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
        const categories = ['Tous', 'P√¢tes', 'Viandes', 'Poissons', 'V√©g√©tarien', 'Soupes', 'Salades', 'Tartes', 'Desserts', 'Diab√©tique', 'Mes Recettes'];
        
        let recettesPerso = [];
        let planning = {};
        let notations = {};
        let categorieActive = 'Tous';
        let recetteActive = null;
        let prochainId = 100;
        let ingredientsCopies = new Set();
        let supermarcheChoisi = null;
        let urlSupermarche = null;
        let rechercheDirecte = false;
        let recettesAPI = [];

        function getToutesRecettes() {
            return [...recettesPredefinies, ...recettesPerso, ...recettesAPI];
        }

        function init() {
            chargerDonnees();
            afficherFiltres();
            afficherRecettes();
            afficherPlanning();
            mettreAJourBadgeCourses();
        }

        function chargerDonnees() {
            const savedRecettes = localStorage.getItem('recettesPerso');
            const savedPlanning = localStorage.getItem('planning');
            const savedNotations = localStorage.getItem('notations');
            
            if (savedRecettes) {
                recettesPerso = JSON.parse(savedRecettes);
                prochainId = Math.max(...recettesPerso.map(r => r.id), 100) + 1;
            }
            if (savedPlanning) {
                planning = JSON.parse(savedPlanning);
            }
            if (savedNotations) {
                notations = JSON.parse(savedNotations);
            }
        }

        function afficherFiltres() {
            const filtersDiv = document.getElementById('filters');
            filtersDiv.innerHTML = categories.map(cat => 
                `<button class="filter-btn ${cat === categorieActive ? 'active' : ''}" 
                        onclick="changerCategorie('${cat}')">${cat}</button>`
            ).join('');
        }

        function changerCategorie(cat) {
            categorieActive = cat;
            afficherFiltres();
            afficherRecettes();
        }

        function afficherRecettes() {
            const listDiv = document.getElementById('recette-list');
            let recettes = getToutesRecettes();
            
            if (categorieActive === 'Mes Recettes') {
                recettes = recettes.filter(r => r.perso);
            } else if (categorieActive !== 'Tous') {
                recettes = recettes.filter(r => r.cat === categorieActive);
            }
            
            if (recettes.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üçΩÔ∏è</div>
                        <h3>Aucune recette</h3>
                        <p>Recherchez des recettes en ligne ou cr√©ez les v√¥tres !</p>
                    </div>
                `;
                return;
            }
            
            listDiv.innerHTML = recettes.map(r => {
                const note = notations[r.id] || 0;
                const noteAffichee = note > 0 ? `${note}/5` : 'Non not√©';
                const sourceAPI = r.source ? `<span class="api-source">${r.source}</span>` : '';
                return `
                <div class="recette-item ${r.perso ? 'perso' : ''}" 
                     draggable="true" 
                     data-recette-id="${r.id}"
                     ondragstart="dragStart(event)"
                     ondragend="dragEnd(event)"
                     onclick="ouvrirModal(${r.id})">
                    ${r.perso ? '<button class="delete-mini-btn" onclick="event.stopPropagation(); supprimerRecette(' + r.id + ')">√ó</button>' : ''}
                    <span class="badge ${r.perso ? 'perso' : ''}">${r.perso ? 'MA RECETTE' : r.cat}</span>${sourceAPI}
                    <h3>${r.nom}</h3>
                    <div style="display: flex; gap: 15px; color: #666; font-size: 0.95em;">
                        <span>‚è±Ô∏è ${r.temps || 'N/A'}</span>
                        <span>üë• ${r.p} pers.</span>
                    </div>
                    <div class="rating" onclick="event.stopPropagation()">
                        ${[1,2,3,4,5].map(etoile => `
                            <span class="star ${etoile <= note ? 'filled' : 'empty'}" 
                                  onclick="noterRecette(${r.id}, ${etoile})">‚òÖ</span>
                        `).join('')}
                        <span class="rating-display">${noteAffichee}</span>
                    </div>
                </div>
            `}).join('');
        }

        function afficherPlanning() {
            const planningRapide = document.getElementById('planning-rapide');
            const planningComplet = document.getElementById('planning-complet');
            
            const html = jours.map(jour => {
                const midi = planning[jour]?.midi;
                const soir = planning[jour]?.soir;
                
                return `
                    <div class="jour-item">
                        <div class="jour-header">
                            <h3>${jour}</h3>
                        </div>
                        <div class="repas-container">
                            <div class="repas-slot midi" 
                                 data-jour="${jour}" 
                                 data-moment="midi"
                                 ondragover="dragOver(event)"
                                 ondragleave="dragLeave(event)"
                                 ondrop="drop(event)">
                                <div class="repas-label">üåû Midi</div>
                                <div class="repas-content ${!midi ? 'empty' : ''}">
                                    ${midi ? `
                                        <div class="plat-info">${midi.nom}</div>
                                        <button class="delete-btn" onclick="retirerRepas('${jour}', 'midi')">Retirer</button>
                                    ` : '<span style="font-size: 0.85em; color: #999;">Glissez une recette ici</span>'}
                                </div>
                            </div>
                            <div class="repas-slot soir" 
                                 data-jour="${jour}" 
                                 data-moment="soir"
                                 ondragover="dragOver(event)"
                                 ondragleave="dragLeave(event)"
                                 ondrop="drop(event)">
                                <div class="repas-label">üåô Soir</div>
                                <div class="repas-content ${!soir ? 'empty' : ''}">
                                    ${soir ? `
                                        <div class="plat-info">${soir.nom}</div>
                                        <button class="delete-btn" onclick="retirerRepas('${jour}', 'soir')">Retirer</button>
                                    ` : '<span style="font-size: 0.85em; color: #999;">Glissez une recette ici</span>'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            planningRapide.innerHTML = html;
            planningComplet.innerHTML = html;
        }

        function ajouterRepas(jour, moment, recette) {
            if (!planning[jour]) planning[jour] = {};
            planning[jour][moment] = recette;
            localStorage.setItem('planning', JSON.stringify(planning));
            afficherPlanning();
            mettreAJourCourses();
            mettreAJourBadgeCourses();
        }

        function retirerRepas(jour, moment) {
            if (planning[jour]) {
                delete planning[jour][moment];
                if (!planning[jour].midi && !planning[jour].soir) {
                    delete planning[jour];
                }
            }
            localStorage.setItem('planning', JSON.stringify(planning));
            afficherPlanning();
            mettreAJourCourses();
            mettreAJourBadgeCourses();
        }

        function mettreAJourCourses() {
            const coursesDiv = document.getElementById('courses-content');
            const supermarchesSection = document.getElementById('supermarches-section');
            
            const ingredients = {};
            Object.values(planning).forEach(jour => {
                ['midi', 'soir'].forEach(moment => {
                    if (jour[moment]) {
                        jour[moment].ing.forEach(ing => {
                            if (!ingredients[ing.n]) {
                                ingredients[ing.n] = [];
                            }
                            ingredients[ing.n].push(ing.q);
                        });
                    }
                });
            });

            const nbIngredients = Object.keys(ingredients).length;

            if (nbIngredients === 0) {
                coursesDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üõí</div>
                        <h3>Votre liste est vide</h3>
                        <p>Ajoutez des recettes √† votre planning pour g√©n√©rer votre liste de courses</p>
                    </div>
                `;
                supermarchesSection.style.display = 'none';
            } else {
                coursesDiv.innerHTML = `
                    <button class="copy-btn" onclick="copierListe()">
                        üìã Copier la liste compl√®te (${nbIngredients} ingr√©dients)
                    </button>
                    <div class="liste-courses" id="liste-ingredients">
                        ${Object.entries(ingredients).map(([nom, quantites]) => {
                            const estCopie = ingredientsCopies.has(nom);
                            return `
                            <div class="ingredient-item ${estCopie ? 'copied' : ''}" data-ingredient="${nom}">
                                <span><strong>${nom}</strong> <span style="color: #666;">(${quantites.join(' + ')})</span></span>
                                <div class="ingredient-actions">
                                    ${estCopie ? 
                                        '<span class="check-mark">‚úì</span>' :
                                        supermarcheChoisi ? 
                                            (rechercheDirecte ? 
                                                `<button class="search-ingredient-btn" onclick="rechercherIngredient('${nom.replace(/'/g, "\\'")}')">
                                                    üîç Rechercher
                                                </button>` :
                                                `<button class="copy-ingredient-btn" onclick="copierIngredient('${nom.replace(/'/g, "\\'")}')">
                                                    üìã Copier
                                                </button>`)
                                            : ''
                                    }
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                `;
                supermarchesSection.style.display = 'block';
            }
        }

        function mettreAJourBadgeCourses() {
            const ingredients = {};
            Object.values(planning).forEach(jour => {
                ['midi', 'soir'].forEach(moment => {
                    if (jour[moment]) {
                        jour[moment].ing.forEach(ing => {
                            ingredients[ing.n] = true;
                        });
                    }
                });
            });
            
            const nb = Object.keys(ingredients).length;
            const badge = document.getElementById('courses-badge');
            badge.innerHTML = nb > 0 ? `<span class="courses-badge">${nb}</span>` : '';
        }

        function copierListe() {
            const ingredients = {};
            Object.values(planning).forEach(jour => {
                ['midi', 'soir'].forEach(moment => {
                    if (jour[moment]) {
                        jour[moment].ing.forEach(ing => {
                            if (!ingredients[ing.n]) ingredients[ing.n] = [];
                            ingredients[ing.n].push(ing.q);
                        });
                    }
                });
            });

            const texte = Object.entries(ingredients)
                .map(([nom, qs]) => `${nom} (${qs.join(' + ')})`)
                .join('\n');
            
            navigator.clipboard.writeText(texte).then(() => {
                alert('‚úÖ Liste compl√®te copi√©e dans le presse-papier !\n\nVous pouvez la coller o√π vous voulez.');
            }).catch(() => {
                alert('‚ùå Erreur lors de la copie. Veuillez s√©lectionner et copier manuellement la liste.');
            });
        }

        function choisirSupermarche(nom, url, directSearch) {
            supermarcheChoisi = nom;
            urlSupermarche = url;
            rechercheDirecte = directSearch;
            ingredientsCopies.clear();
            
            // Afficher le supermarch√© choisi
            document.getElementById('supermarche-choisi').style.display = 'block';
            document.getElementById('nom-supermarche').textContent = nom;
            
            // Rafra√Æchir la liste pour afficher les bons boutons
            mettreAJourCourses();
            
            // Scroll vers la liste
            document.getElementById('courses-content').scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            if (directSearch) {
                alert(`‚úÖ ${nom} s√©lectionn√© !\n\nüîç Mode Recherche Directe\nCliquez sur "Rechercher" pour chaque ingr√©dient.\nUn onglet s'ouvrira avec les r√©sultats.`);
            } else {
                alert(`‚úÖ ${nom} s√©lectionn√© !\n\nüìã Mode Copier-Coller\nCliquez sur "Copier" pour chaque ingr√©dient.\nPuis collez dans la barre de recherche du site.`);
            }
        }

        function rechercherIngredient(nomIngredient) {
            // Marquer comme copi√©
            ingredientsCopies.add(nomIngredient);
            
            // Ouvrir recherche directe
            const recherche = encodeURIComponent(nomIngredient);
            window.open(urlSupermarche + recherche, '_blank');
            
            // Rafra√Æchir l'affichage
            mettreAJourCourses();
        }

        function copierIngredient(nomIngredient) {
            navigator.clipboard.writeText(nomIngredient).then(() => {
                // Marquer comme copi√©
                ingredientsCopies.add(nomIngredient);
                
                // Notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #4CAF50, #66BB6A);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 15px;
                    font-weight: bold;
                    box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
                    z-index: 10000;
                    animation: slideIn 0.3s ease;
                `;
                notification.textContent = `‚úì "${nomIngredient}" copi√© ! Collez sur ${supermarcheChoisi}.`;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
                
                // Rafra√Æchir l'affichage
                mettreAJourCourses();
            }).catch(() => {
                alert(`‚ùå Erreur : impossible de copier "${nomIngredient}"`);
            });
        }

        function noterRecette(recetteId, note) {
            notations[recetteId] = note;
            localStorage.setItem('notations', JSON.stringify(notations));
            afficherRecettes();
        }

        // Recherche de recettes via TheMealDB API
        async function rechercherRecettesAPI() {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const loadingDiv = document.getElementById('loading-recipes');
            const query = searchInput.value.trim();
            
            if (!query) {
                alert('‚ö†Ô∏è Veuillez entrer un terme de recherche');
                return;
            }
            
            searchBtn.disabled = true;
            searchBtn.textContent = '‚è≥ Recherche...';
            loadingDiv.style.display = 'block';
            
            try {
                const response = await fetch(`https://www.themealdb.com/api/json/v1/1/search.php?s=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.meals) {
                    const resultats = data.meals.map(meal => {
                        // Extraire les ingr√©dients
                        const ingredients = [];
                        for (let i = 1; i <= 20; i++) {
                            const ing = meal[`strIngredient${i}`];
                            const measure = meal[`strMeasure${i}`];
                            if (ing && ing.trim()) {
                                ingredients.push({n: ing, q: measure || ''});
                            }
                        }
                        
                        // Extraire les √©tapes
                        const instructions = meal.strInstructions ? 
                            meal.strInstructions.split('\r\n').filter(s => s.trim()) : 
                            ['Voir les instructions compl√®tes'];
                        
                        return {
                            id: `api_${meal.idMeal}`,
                            nom: meal.strMeal,
                            cat: meal.strCategory || 'International',
                            temps: '30min',
                            p: 4,
                            perso: false,
                            source: 'TheMealDB',
                            ing: ingredients,
                            rec: instructions,
                            image: meal.strMealThumb
                        };
                    });
                    
                    afficherModalResultats(resultats, query);
                } else {
                    alert('‚ùå Aucune recette trouv√©e. Essayez un autre terme.');
                }
            } catch (error) {
                console.error('Erreur API:', error);
                alert('‚ùå Erreur lors de la recherche. V√©rifiez votre connexion.');
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'Rechercher';
                loadingDiv.style.display = 'none';
            }
        }

        function afficherModalResultats(resultats, query) {
            const modal = document.getElementById('modal-resultats');
            const titre = document.getElementById('titre-resultats');
            const contenu = document.getElementById('contenu-resultats');
            
            titre.textContent = `üìö ${resultats.length} recette(s) trouv√©e(s) pour "${query}"`;
            
            contenu.innerHTML = resultats.map(r => `
                <div class="recette-item" style="margin-bottom: 15px;" onclick="ajouterRecetteAPI(${r.id.replace('api_', '')})">
                    ${r.image ? `<img src="${r.image}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 15px; margin-bottom: 10px;">` : ''}
                    <span class="badge">${r.cat}</span>
                    <span class="api-source">${r.source}</span>
                    <h3>${r.nom}</h3>
                    <div style="display: flex; gap: 15px; color: #666; font-size: 0.95em; margin-top: 10px;">
                        <span>‚è±Ô∏è ${r.temps}</span>
                        <span>üë• ${r.p} pers.</span>
                        <span>üõí ${r.ing.length} ingr√©dients</span>
                    </div>
                    <button class="btn-primary" style="margin-top: 10px; padding: 10px 20px; font-size: 0.9em;" onclick="event.stopPropagation(); ajouterRecetteAPI(${r.id.replace('api_', '')})">
                        ‚ûï Ajouter √† mes recettes
                    </button>
                </div>
            `).join('');
            
            // Stocker temporairement les r√©sultats
            window.resultatsRecherche = resultats;
            
            modal.classList.add('active');
        }

        function fermerModalResultats() {
            document.getElementById('modal-resultats').classList.remove('active');
        }

        function ajouterRecetteAPI(mealId) {
            const recette = window.resultatsRecherche.find(r => r.id === `api_${mealId}`);
            if (!recette) return;
            
            // V√©rifier si la recette existe d√©j√†
            const existe = recettesAPI.find(r => r.id === recette.id);
            if (existe) {
                alert('‚ÑπÔ∏è Cette recette est d√©j√† dans votre liste !');
                return;
            }
            
            recettesAPI.push(recette);
            alert(`‚úÖ "${recette.nom}" ajout√©e √† vos recettes !`);
            afficherRecettes();
            fermerModalResultats();
        }

        // G√©n√©rer une recette avec des templates pr√©d√©finis
        async function genererRecetteIA() {
            const categories = [
                {nom: 'P√¢tes', exemples: ['Carbonara aux l√©gumes', 'P√¢tes cr√©meuses aux champignons', 'Spaghetti aglio e olio']},
                {nom: 'Viandes', exemples: ['Poulet r√¥ti aux herbes', 'B≈ìuf saut√© aux l√©gumes', 'C√¥telettes de porc miel-moutarde']},
                {nom: 'Poissons', exemples: ['Saumon grill√© citronn√©', 'Dorade au four m√©diterran√©enne', 'Cabillaud aux tomates']},
                {nom: 'V√©g√©tarien', exemples: ['Buddha bowl quinoa', 'Curry de pois chiches', 'Gratin de l√©gumes']},
                {nom: 'Soupes', exemples: ['Velout√© de butternut', 'Soupe de lentilles corail', 'Minestrone italien']},
                {nom: 'Salades', exemples: ['Salade C√©sar revisit√©e', 'Bowl mexicain', 'Salade grecque authentique']},
                {nom: 'Tartes', exemples: ['Tarte √©pinards-ricotta', 'Quiche lorraine classique', 'Tarte fine tomates']},
                {nom: 'Desserts', exemples: ['Mousse au chocolat l√©g√®re', 'Tarte aux pommes maison', 'Crumble aux fruits']}
            ];
            
            const choixCategorie = categories[Math.floor(Math.random() * categories.length)];
            const choixRecette = choixCategorie.exemples[Math.floor(Math.random() * choixCategorie.exemples.length)];
            
            const recetteNom = prompt(`ü§ñ G√©n√©rer une recette personnalis√©e\n\nSuggestion: "${choixRecette}"\n\nOu entrez votre propre id√©e:`);
            
            if (!recetteNom || !recetteNom.trim()) return;
            
            const loadingDiv = document.getElementById('loading-recipes');
            loadingDiv.style.display = 'block';
            loadingDiv.innerHTML = 'ü§ñ G√©n√©ration de votre recette...';
            
            // Utiliser un template intelligent bas√© sur les mots-cl√©s
            const motsCles = recetteNom.toLowerCase();
            let categorie = 'V√©g√©tarien';
            
            if (motsCles.includes('p√¢tes') || motsCles.includes('pasta') || motsCles.includes('spaghetti')) categorie = 'P√¢tes';
            else if (motsCles.includes('poulet') || motsCles.includes('boeuf') || motsCles.includes('viande')) categorie = 'Viandes';
            else if (motsCles.includes('poisson') || motsCles.includes('saumon') || motsCles.includes('cabillaud')) categorie = 'Poissons';
            else if (motsCles.includes('soupe') || motsCles.includes('velout√©')) categorie = 'Soupes';
            else if (motsCles.includes('salade') || motsCles.includes('bowl')) categorie = 'Salades';
            else if (motsCles.includes('tarte') || motsCles.includes('quiche')) categorie = 'Tartes';
            else if (motsCles.includes('dessert') || motsCles.includes('g√¢teau') || motsCles.includes('mousse')) categorie = 'Desserts';
            
            // Templates d'ingr√©dients par cat√©gorie
            const templatesIngredients = {
                'P√¢tes': [
                    {n:"P√¢tes", q:"400g"},
                    {n:"Huile d'olive", q:"3 c.√†.s"},
                    {n:"Ail", q:"2 gousses"},
                    {n:"Sel et poivre", q:"Au go√ªt"}
                ],
                'Viandes': [
                    {n:"Viande au choix", q:"600g"},
                    {n:"Oignons", q:"2"},
                    {n:"Herbes de Provence", q:"1 c.√†.s"},
                    {n:"Huile d'olive", q:"2 c.√†.s"}
                ],
                'V√©g√©tarien': [
                    {n:"L√©gumes vari√©s", q:"800g"},
                    {n:"Huile d'olive", q:"3 c.√†.s"},
                    {n:"√âpices", q:"2 c.√†.s"},
                    {n:"Sel et poivre", q:"Au go√ªt"}
                ]
            };
            
            const ingredients = templatesIngredients[categorie] || templatesIngredients['V√©g√©tarien'];
            
            const etapes = [
                "Pr√©parer et couper tous les ingr√©dients",
                "Faire chauffer l'huile dans une po√™le ou casserole",
                "Faire revenir les aromates (ail, oignons) quelques minutes",
                "Ajouter les ingr√©dients principaux et cuire selon les indications",
                "Assaisonner et ajuster le go√ªt",
                "Servir chaud et d√©guster"
            ];
            
            setTimeout(() => {
                const nouvelleRecette = {
                    id: prochainId++,
                    nom: recetteNom,
                    cat: categorie,
                    temps: '30min',
                    p: 4,
                    ing: ingredients,
                    rec: etapes,
                    perso: true,
                    source: 'ü§ñ G√©n√©r√©e'
                };
                
                recettesPerso.push(nouvelleRecette);
                localStorage.setItem('recettesPerso', JSON.stringify(recettesPerso));
                
                loadingDiv.style.display = 'none';
                loadingDiv.innerHTML = 'üîÑ Recherche en cours...';
                
                alert(`‚úÖ Recette "${nouvelleRecette.nom}" cr√©√©e !\n\nüí° Conseil: Modifiez-la en cliquant dessus pour personnaliser les ingr√©dients et les √©tapes.`);
                categorieActive = 'Tous';
                afficherFiltres();
                afficherRecettes();
            }, 1500);
        }

        // Gestion de la touche Entr√©e pour la recherche
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        rechercherRecettesAPI();
                    }
                });
            }
        });

        function ouvrirModal(recetteId) {
            const recettes = getToutesRecettes();
            recetteActive = recettes.find(r => r.id === recetteId);
            const modal = document.getElementById('modal');
            const note = notations[recetteId] || 0;
            
            document.getElementById('modal-titre').textContent = recetteActive.nom;
            document.getElementById('modal-info').innerHTML = `
                ‚è±Ô∏è ${recetteActive.temps || 'N/A'} ‚Ä¢ üë• ${recetteActive.p} pers. ‚Ä¢ üìÅ ${recetteActive.cat}
                ${recetteActive.perso ? ' ‚Ä¢ <span style="color: #FFD700;">‚òÖ MA RECETTE</span>' : ''}
                <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 0.9em;">Votre note :</span>
                    ${[1,2,3,4,5].map(etoile => `
                        <span class="star ${etoile <= note ? 'filled' : 'empty'}" 
                              style="font-size: 1.5em; cursor: pointer;"
                              onclick="noterRecette(${recetteId}, ${etoile}); ouvrirModal(${recetteId})">‚òÖ</span>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('modal-ingredients').innerHTML = recetteActive.ing.map(ing => `
                <div style="padding: 12px; background: linear-gradient(135deg, #FFE5EC, #FFF0F5); border-radius: 12px; display: flex; justify-content: space-between; border: 2px solid #FF6B9D;">
                    <span><strong>${ing.n}</strong></span>
                    <span style="color: #666;">${ing.q}</span>
                </div>
            `).join('');
            
            document.getElementById('modal-preparation').innerHTML = recetteActive.rec.map((etape, idx) => `
                <div style="display: flex; gap: 15px; margin-bottom: 15px; padding: 18px; background: linear-gradient(135deg, #FFF9E6, #FFFEF0); border-radius: 15px; border-left: 6px solid #FF6B9D;">
                    <div style="background: linear-gradient(135deg, #FF6B9D, #FFA07A); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; box-shadow: 0 4px 10px rgba(255, 107, 157, 0.3);">
                        ${idx + 1}
                    </div>
                    <p style="line-height: 1.6; color: #333;">${etape}</p>
                </div>
            `).join('');
            
            document.getElementById('modal-repas').innerHTML = jours.flatMap(jour => [
                {jour, moment: 'midi', label: `${jour} üåû`},
                {jour, moment: 'soir', label: `${jour} üåô`}
            ]).map(({jour, moment, label}) => {
                const estSelectionne = planning[jour]?.[moment]?.id === recetteActive.id;
                return `
                    <button class="repas-btn ${estSelectionne ? 'selected' : ''}" 
                            onclick="toggleRepas('${jour}', '${moment}')">
                        ${estSelectionne ? '‚úì ' : ''}${label}
                    </button>
                `;
            }).join('');
            
            modal.classList.add('active');
        }

        function fermerModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function toggleRepas(jour, moment) {
            if (planning[jour]?.[moment]?.id === recetteActive.id) {
                retirerRepas(jour, moment);
            } else {
                ajouterRepas(jour, moment, recetteActive);
            }
            
            document.getElementById('modal-repas').innerHTML = jours.flatMap(j => [
                {jour: j, moment: 'midi', label: `${j} üåû`},
                {jour: j, moment: 'soir', label: `${j} üåô`}
            ]).map(({jour: j, moment: m, label}) => {
                const estSelectionne = planning[j]?.[m]?.id === recetteActive.id;
                return `
                    <button class="repas-btn ${estSelectionne ? 'selected' : ''}" 
                            onclick="toggleRepas('${j}', '${m}')">
                        ${estSelectionne ? '‚úì ' : ''}${label}
                    </button>
                `;
            }).join('');
        }

        function ouvrirModalNouvelleRecette() {
            document.getElementById('modal-nouvelle-recette').classList.add('active');
        }

        function fermerModalNouvelleRecette() {
            document.getElementById('modal-nouvelle-recette').classList.remove('active');
            document.getElementById('form-nouvelle-recette').reset();
            document.getElementById('ingredients-inputs').innerHTML = `
                <div class="ingredient-row">
                    <input type="text" placeholder="Nom ingr√©dient" class="ing-nom" required>
                    <input type="text" placeholder="Quantit√©" class="ing-qte" required>
                    <button type="button" class="btn-add" onclick="ajouterIngredient()">+</button>
                </div>
            `;
            document.getElementById('etapes-list').innerHTML = `
                <div class="etape-row">
                    <div class="etape-number">1</div>
                    <textarea rows="3" class="etape-text" required placeholder="D√©crivez l'√©tape 1..."></textarea>
                    <button type="button" class="btn-add" onclick="ajouterEtape()">+</button>
                </div>
            `;
        }

        function ajouterIngredient() {
            const container = document.getElementById('ingredients-inputs');
            const div = document.createElement('div');
            div.className = 'ingredient-row';
            div.innerHTML = `
                <input type="text" placeholder="Nom ingr√©dient" class="ing-nom" required>
                <input type="text" placeholder="Quantit√©" class="ing-qte" required>
                <button type="button" class="btn-remove" onclick="this.parentElement.remove()">‚àí</button>
            `;
            container.appendChild(div);
        }

        function ajouterEtape() {
            const container = document.getElementById('etapes-list');
            const numero = container.children.length + 1;
            const div = document.createElement('div');
            div.className = 'etape-row';
            div.innerHTML = `
                <div class="etape-number">${numero}</div>
                <textarea rows="3" class="etape-text" required placeholder="D√©crivez l'√©tape ${numero}..."></textarea>
                <button type="button" class="btn-remove" onclick="this.parentElement.remove(); renumeroterEtapes()">‚àí</button>
            `;
            container.appendChild(div);
        }

        function renumeroterEtapes() {
            const etapes = document.querySelectorAll('#etapes-list .etape-row');
            etapes.forEach((etape, idx) => {
                etape.querySelector('.etape-number').textContent = idx + 1;
                etape.querySelector('textarea').placeholder = `D√©crivez l'√©tape ${idx + 1}...`;
            });
        }

        function sauvegarderNouvelleRecette(event) {
            event.preventDefault();
            
            const nom = document.getElementById('nom-recette').value;
            const categorie = document.getElementById('categorie-recette').value;
            const temps = document.getElementById('temps-recette').value || 'N/A';
            const portions = parseInt(document.getElementById('portions-recette').value);
            
            const ingredients = Array.from(document.querySelectorAll('#ingredients-inputs .ingredient-row'))
                .map(row => ({
                    n: row.querySelector('.ing-nom').value,
                    q: row.querySelector('.ing-qte').value
                }));
            
            const etapes = Array.from(document.querySelectorAll('#etapes-list .etape-text'))
                .map(textarea => textarea.value);
            
            const nouvelleRecette = {
                id: prochainId++,
                nom: nom,
                cat: categorie,
                temps: temps,
                p: portions,
                ing: ingredients,
                rec: etapes,
                perso: true
            };
            
            recettesPerso.push(nouvelleRecette);
            localStorage.setItem('recettesPerso', JSON.stringify(recettesPerso));
            
            fermerModalNouvelleRecette();
            afficherRecettes();
            
            alert('‚úÖ Recette sauvegard√©e avec succ√®s !');
        }

        function supprimerRecette(id) {
            if (confirm('Voulez-vous vraiment supprimer cette recette ?')) {
                recettesPerso = recettesPerso.filter(r => r.id !== id);
                localStorage.setItem('recettesPerso', JSON.stringify(recettesPerso));
                afficherRecettes();
            }
        }

        function changerVue(vue) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + vue).classList.add('active');
            
            if (vue === 'courses') {
                mettreAJourCourses();
            }
        }

        // Fonctions de glisser-d√©poser
        let recetteDragee = null;

        function dragStart(event) {
            const recetteId = parseInt(event.target.dataset.recetteId);
            recetteDragee = getToutesRecettes().find(r => r.id === recetteId);
            event.target.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
        }

        function dragEnd(event) {
            event.target.classList.remove('dragging');
        }

        function dragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            event.currentTarget.classList.add('drag-over');
        }

        function dragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function drop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');
            
            const jour = event.currentTarget.dataset.jour;
            const moment = event.currentTarget.dataset.moment;
            
            if (recetteDragee) {
                ajouterRepas(jour, moment, recetteDragee);
                recetteDragee = null;
            }
        }

        window.onclick = function(event) {
            if (event.target.id === 'modal') fermerModal();
            if (event.target.id === 'modal-nouvelle-recette') fermerModalNouvelleRecette();
            if (event.target.id === 'modal-resultats') fermerModalResultats();
            if (event.target.id === 'modal-ia') fermerModalIA();
        }

        init();
    </script>
</body>
</html>
